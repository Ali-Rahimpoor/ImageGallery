import{r as i,C as N,j as e,L as w}from"./index-DjPyylNu.js";import{G as y,a as k,S}from"./SkeletonLoader--6jG4EK-.js";const b=(a,r,s=24*60*60*1e3)=>{const o={data:r,timestamp:new Date().getTime(),ttl:s};localStorage.setItem(a,JSON.stringify(o))},j=a=>{const r=localStorage.getItem(a);if(!r)return null;const s=JSON.parse(r);return new Date().getTime()-s.timestamp>s.ttl?(localStorage.removeItem(a),null):s.data},v=(a,r,s)=>{const[o,n]=i.useState(!1),[f,c]=i.useState([]),[d,h]=i.useState(!1),m=i.useCallback(async()=>{try{switch(n(!0),c([]),r>0&&(localStorage.removeItem("apod_data"),localStorage.removeItem("mars_photos"),h(!0)),a){case"APOD":const t="apod_data";if(!d){const x=j(t);if(x){c(x.sort(()=>.5-Math.random()).slice(0,9));return}}const{data:l}=await k();d||b(t,l),c(l.sort(()=>.5-Math.random()).slice(0,9));break;case"MARS":const p=Math.floor(Math.random()*4e3),g="mars_photos";if(!d){const x=j(g);if(x){c(x.sort(()=>.5-Math.random()).slice(0,18));return}}const{data:u}=await y(p);d||b(g,u.photos),c(u.photos.sort(()=>.5-Math.random()).slice(0,18));break;default:throw new Error("Invalid title")}}catch(t){throw console.error(t),new Error(t)}finally{n(!1),s(0),h(!1)}},[a,r]);return i.useEffect(()=>{m()},[m]),{images:f,loading:o,fetchImages:m}},_=()=>{const{title:a}=i.useContext(N),[r,s]=i.useState(0),{images:o,loading:n,fetchImages:f}=v(a,r,s),c=()=>{s(t=>t+1)},d=()=>{f()},h=t=>{window.open(t.hdurl||t.url,"_blank")},m=t=>{window.open(t.img_src,"_blank")};return n?e.jsxs(e.Fragment,{children:[e.jsx("section",{className:"container font-Karla mt-2 p-2 md:gap-8 xs:gap-7 gap-4 grid grid-cols-2 sm:grid-cols-3",children:Array.from({length:a==="APOD"?9:18}).map((t,l)=>e.jsx(S,{},l))}),e.jsx("nav",{className:"flex items-center justify-center bg-gradient-to-tl from-zinc-900 to-zinc-600 p-2",children:e.jsx("button",{disabled:!0,className:"shadow text-xl font-Karla bg-white/5 text-gray-200 px-8 py-2 rounded",children:e.jsx("span",{className:"animate-spin",children:"↻"})})})]}):o.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64",children:[e.jsx("p",{className:"text-gray-400 text-lg",children:"No images found"}),e.jsx("button",{className:"mt-4 shadow text-xl font-Karla bg-black/75 text-gray-200 px-8 py-2 rounded",children:e.jsx(w,{to:"/home",children:"↻ Try Again"})})]}):e.jsxs(e.Fragment,{children:[a==="APOD"?e.jsx("section",{className:"container font-Karla mt-2 p-2 md:gap-8 xs:gap-7 gap-4 grid grid-cols-2 sm:grid-cols-3",children:o.map((t,l)=>e.jsxs("div",{onDoubleClick:()=>h(t),className:"relative sm:hover:scale-95 sm:transition-transform cursor-pointer",children:[e.jsx("img",{className:"w-full h-fit rounded-md object-cover",src:t.hdurl||t.url,alt:"Photo",loading:"lazy"}),e.jsxs("div",{className:"text-gray-200",children:[e.jsx("p",{className:"absolute line-clamp-1 shadow md:text-sm bg-black/20 p-1 text-[10px] xs:text-xs md:top-3 top-1 left-1 md:left-3",children:t.title}),e.jsx("p",{className:"absolute md:bottom-2 bottom-1 text-[9px] xs:text-xs md:text-base line-clamp-1 right-1 md:right-2 bg-black/20 shadow p-1 font-KarlaBold tracking-wide",children:t.date})]})]},l))}):e.jsx("section",{className:"container font-Karla mt-2 p-2 md:gap-8 xs:gap-7 gap-4 grid grid-cols-2 sm:grid-cols-3",children:o.map((t,l)=>{var p;return e.jsxs("div",{onDoubleClick:()=>m(t),className:"relative sm:hover:scale-95 sm:transition-transform cursor-pointer",children:[e.jsx("img",{src:t.img_src,className:"w-full h-fit rounded-md object-cover",alt:"Photo",loading:"lazy"}),e.jsxs("div",{children:[e.jsx("p",{className:"absolute sm:top-3 top-1 left-1 sm:left-3 bg-black/20 text-xs sm:text-base text-gray-200 rounded-sm sm:px-2 px-1 py-1",children:(t==null?void 0:t.earth_date)||"NODate"}),e.jsx("p",{className:"absolute xs:bottom-2 bottom-1 p-1 rounded text-[9px] sm:text-xs bg-black/20 right-1 xs:right-2 text-gray-200",children:((p=t==null?void 0:t.camera)==null?void 0:p.name)||"NoName"})]})]},l)})}),e.jsxs("nav",{className:"flex gap-x-2 items-center justify-center bg-gradient-to-tl from-zinc-900 to-zinc-600 p-2",children:[e.jsx("button",{onClick:c,disabled:n,className:"shadow text-xl font-Karla bg-white/5 text-gray-200 px-8 cursor-pointer py-2 rounded",children:n?e.jsx("span",{className:"animate-spin",children:"↻"}):e.jsx("span",{className:"xs:text-base text-sm",children:"(Skip Cache)"})}),e.jsx("button",{onClick:d,disabled:n,className:"shadow text-xl font-Karla bg-white/5 text-gray-200 px-8 cursor-pointer py-2 rounded",children:n?e.jsx("span",{className:"animate-spin",children:"↻"}):e.jsx("span",{className:"xs:text-base text-sm",children:"↻ Refresh"})})]})]})};export{_ as default};
